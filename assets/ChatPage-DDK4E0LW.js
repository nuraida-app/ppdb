import{m as I,n as L,j as t,aU as E,a as G,r as s,aV as H,aW as P,G as m,P as h,e as C,aX as $,aY as O,aZ as V,q,a_ as T,d as S,s as l,T as W,z as b,a$ as A,b0 as F}from"./index-C2nBX7QG.js";import{L as Q,a as K}from"./Layout-C20c01LT.js";import{B as X}from"./ButtonGroup-BomsUINC.js";var p={},Y=L;Object.defineProperty(p,"__esModule",{value:!0});var M=p.default=void 0,Z=Y(I()),J=t;M=p.default=(0,Z.default)((0,J.jsx)("path",{d:"M4 4h16v12H5.17L4 17.17zm0-2c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm2 10h8v2H6zm0-3h12v2H6zm0-3h12v2H6z"}),"ChatOutlined");var x={},N=L;Object.defineProperty(x,"__esModule",{value:!0});var k=x.default=void 0,U=N(I()),ee=t;k=x.default=(0,U.default)((0,ee.jsx)("path",{d:"M4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29M20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m4 3.43c0-.81-.48-1.53-1.22-1.85-.85-.37-1.79-.58-2.78-.58-.39 0-.76.04-1.13.1.4.68.63 1.46.63 2.29V18H24zm-7.76-2.78c-1.17-.52-2.61-.9-4.24-.9s-3.07.39-4.24.9C6.68 14.13 6 15.21 6 16.39V18h12v-1.61c0-1.18-.68-2.26-1.76-2.74M8.07 16c.09-.23.13-.39.91-.69.97-.38 1.99-.56 3.02-.56s2.05.18 3.02.56c.77.3.81.46.91.69zM12 8c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m0-2c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"GroupsOutlined");const z=E("https://ppdb-api.nibs.sch.id",{withCredentials:!0}),te=new Audio("/chat_sound.mp3"),re=()=>{const{user:n}=G(e=>e.user),[a,w]=s.useState(null),[o,f]=s.useState([]),[d,g]=s.useState(""),[j,v]=s.useState({}),c=s.useRef(null),{data:u}=H(),{data:_}=P(a==null?void 0:a.id,{skip:!(a!=null&&a.id)}),B=e=>{if(e.preventDefault(),!d)return;const i={sender_id:n==null?void 0:n.id,sender:n==null?void 0:n.name,sender_role:"admin",recipient_id:a==null?void 0:a.id,recipient:a==null?void 0:a.name,recipient_role:a==null?void 0:a.role,chat:d};z.emit("message",i),g("")},D=e=>j[e]||0;return s.useEffect(()=>{a&&(f(_||[]),v(e=>({...e,[a.name]:0})))},[a,_]),s.useEffect(()=>{z.on("message",e=>{const i=e.rows[0];(i.penerima_role==="admin"||i.pengirim_role==="admin")&&(i.penerima_id===(a==null?void 0:a.id)||i.pengirim_id===(a==null?void 0:a.id))?f(r=>[...r,i]):(v(r=>({...r,[i.pengirim]:(r[i.pengirim]||0)+1})),te.play())})},[a]),s.useEffect(()=>{c.current&&c.current.scrollIntoView({behavior:"smooth"})},[o]),console.log(j),t.jsx(Q,{children:t.jsxs(m,{container:!0,children:[t.jsx(m,{item:!0,size:3,children:t.jsxs(h,{sx:{m:1,p:1,height:{md:550,lg:580,xl:660},overflow:"auto"},children:[t.jsxs(X,{fullWidth:!0,children:[t.jsx(C,{startIcon:t.jsx(M,{}),children:"Pesan"}),t.jsx(C,{startIcon:t.jsx(k,{}),children:"User"})]}),t.jsx($,{children:u==null?void 0:u.map(e=>{var r,y;const i=(y=(r=e.berkas)==null?void 0:r.find(R=>R.Foto))==null?void 0:y.Foto;return t.jsxs(K,{onClick:()=>w(e),children:[t.jsx(O,{children:t.jsx(V,{color:"error",badgeContent:D(e.name),max:10,children:t.jsx(q,{src:i})})}),t.jsx(T,{primary:e==null?void 0:e.name,secondary:e==null?void 0:e.email})]},e==null?void 0:e.id)})})]})}),t.jsx(m,{item:!0,size:9,children:t.jsxs(h,{sx:{p:1,m:1,height:{md:500,lg:580,xl:660}},children:[t.jsx(S,{sx:{height:"93%",overflow:"auto"},children:a?t.jsxs(S,{sx:{display:"flex",flexDirection:"column",gap:1,height:{md:500,lg:520,xl:600}},children:[o==null?void 0:o.map((e,i)=>t.jsxs(h,{sx:{p:1,bgcolor:e.pengirim_role==="user"?"#6069B6":"#258032",color:"#fff",display:"flex",flexDirection:"column",width:"40%",alignSelf:e.pengirim_role==="user"?"flex-end":"flex-start"},children:[t.jsx(l,{align:e.pengirim_role==="user"?"right":"left",fontWeight:"bold",children:e.pengirim}),t.jsx(l,{align:e.pengirim_role==="user"?"right":"left",children:e.teks}),t.jsx(l,{fontSize:10,align:e.pengirim_role==="user"?"right":"left",children:new Date(e.created_at).toLocaleString("id-ID")})]},i)),t.jsx("div",{ref:c})]}):t.jsx(l,{children:"Pilih user untuk memulai pesan"})}),t.jsxs("form",{onSubmit:B,style:{display:"flex",alignItems:"center"},children:[t.jsx(W,{placeholder:"Ketik pesan",value:d,onChange:e=>g(e.target.value),fullWidth:!0,size:"small",variant:"standard"}),t.jsx(b,{color:"primary",children:t.jsx(A,{})}),t.jsx(b,{type:"submit",color:"success",children:t.jsx(F,{})})]})]})})]})})};export{re as default};
